.PHONY: help build up down logs clean dev prod restart

# é è¨­ç›®æ¨™
help:
	@echo "ğŸ³ Jacky å€‹äººæŠ€è¡“ç¶²ç«™ - Docker ç®¡ç†"
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤ï¼š"
	@echo "  make build    - å»ºç½® Docker æ˜ åƒ"
	@echo "  make up       - å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ (Jekyll + Nginx)"
	@echo "  make dev      - å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ (åƒ… Jekyll)"
	@echo "  make down     - åœæ­¢æ‰€æœ‰æœå‹™"
	@echo "  make logs     - æŸ¥çœ‹æœå‹™æ—¥èªŒ"
	@echo "  make clean    - æ¸…ç† Docker è³‡æº"
	@echo "  make restart  - é‡æ–°å•Ÿå‹•æœå‹™"
	@echo "  make help     - é¡¯ç¤ºæ­¤èªªæ˜"

# å»ºç½®æ˜ åƒ
build:
	@echo "ğŸ”¨ å»ºç½® Docker æ˜ åƒ..."
	docker-compose build

# å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ
up:
	@echo "ğŸš€ å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ..."
	docker-compose up -d
	@echo "âœ… ç”Ÿç”¢ç’°å¢ƒå·²å•Ÿå‹•ï¼"
	@echo "ğŸ“ Jekyll: http://localhost:4000"
	@echo "ğŸŒ Nginx:  http://localhost:80"

# å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
dev:
	@echo "ğŸš€ å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ..."
	docker-compose -f docker-compose.dev.yml up -d
	@echo "âœ… é–‹ç™¼ç’°å¢ƒå·²å•Ÿå‹•ï¼"
	@echo "ğŸ“ ç¶²ç«™: http://localhost:4000"
	@echo "ğŸ”„ å³æ™‚é‡æ–°è¼‰å…¥å·²å•Ÿç”¨"

# åœæ­¢æœå‹™
down:
	@echo "ğŸ›‘ åœæ­¢æ‰€æœ‰æœå‹™..."
	docker-compose down
	docker-compose -f docker-compose.dev.yml down
	@echo "âœ… æ‰€æœ‰æœå‹™å·²åœæ­¢"

# æŸ¥çœ‹æ—¥èªŒ
logs:
	@echo "ğŸ“‹ æŸ¥çœ‹æœå‹™æ—¥èªŒ..."
	docker-compose logs -f

# æŸ¥çœ‹é–‹ç™¼ç’°å¢ƒæ—¥èªŒ
logs-dev:
	@echo "ğŸ“‹ æŸ¥çœ‹é–‹ç™¼ç’°å¢ƒæ—¥èªŒ..."
	docker-compose -f docker-compose.dev.yml logs -f

# æ¸…ç† Docker è³‡æº
clean:
	@echo "ğŸ§¹ æ¸…ç† Docker è³‡æº..."
	docker system prune -f
	docker volume prune -f
	@echo "âœ… æ¸…ç†å®Œæˆ"

# é‡æ–°å•Ÿå‹•æœå‹™
restart:
	@echo "ğŸ”„ é‡æ–°å•Ÿå‹•æœå‹™..."
	make down
	make up

# é‡æ–°å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
restart-dev:
	@echo "ğŸ”„ é‡æ–°å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ..."
	docker-compose -f docker-compose.dev.yml down
	make dev

# å»ºç½®ä¸¦å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ
build-up:
	@echo "ğŸ”¨ å»ºç½®ä¸¦å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ..."
	docker-compose up --build -d
	@echo "âœ… ç”Ÿç”¢ç’°å¢ƒå·²å•Ÿå‹•ï¼"

# å»ºç½®ä¸¦å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ
build-dev:
	@echo "ğŸ”¨ å»ºç½®ä¸¦å•Ÿå‹•é–‹ç™¼ç’°å¢ƒ..."
	docker-compose -f docker-compose.dev.yml up --build -d
	@echo "âœ… é–‹ç™¼ç’°å¢ƒå·²å•Ÿå‹•ï¼"

# é€²å…¥å®¹å™¨
shell:
	@echo "ğŸš é€²å…¥ Jekyll å®¹å™¨..."
	docker-compose exec jekyll-site /bin/bash

# é€²å…¥é–‹ç™¼å®¹å™¨
shell-dev:
	@echo "ğŸš é€²å…¥é–‹ç™¼å®¹å™¨..."
	docker-compose -f docker-compose.dev.yml exec jekyll-site /bin/bash

# é‡æ–°å»ºç½®ç¶²ç«™
rebuild-site:
	@echo "ğŸ”¨ é‡æ–°å»ºç½®ç¶²ç«™..."
	docker-compose exec jekyll-site bundle exec jekyll build
	@echo "âœ… ç¶²ç«™é‡æ–°å»ºç½®å®Œæˆ"

# ç‹€æ…‹æª¢æŸ¥
status:
	@echo "ğŸ“Š æª¢æŸ¥æœå‹™ç‹€æ…‹..."
	docker-compose ps
	@echo ""
	@echo "ğŸ“Š é–‹ç™¼ç’°å¢ƒç‹€æ…‹..."
	docker-compose -f docker-compose.dev.yml ps
